<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Azure ARM Templates - Part 4: Azure Portal Custom Deployment | markkerry.github.io</title><meta name=keywords content="Azure,ARM Templates,IaC"><meta name=description content="In my previous posts I walked through the process to author ARM templates using VS Code and the Azure Resource Manager (ARM) Tools extension. In this post I will walk through the process to author ARM templates from scratch using the Azure portal&rsquo;s Custom Deployment feature. It&rsquo;s handy for getting started with ARM template authoring, but as you will see below, creates resources with old API versions, bloats the variables element, and creates the variables element at the bottom of the template."><meta name=author content="Mark kerry"><link rel=canonical href=https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/><link crossorigin=anonymous href=/assets/css/stylesheet.min.b9ff4cc257e914dab489bd18086151800e18f91456a5174bf28489210227a659.css integrity="sha256-uf9MwlfpFNq0ib0YCGFRgA4Y+RRWpRdL8oSJIQInplk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://markkerry.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://markkerry.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://markkerry.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://markkerry.github.io/apple-touch-icon.png><link rel=mask-icon href=https://markkerry.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.100.2"><script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','')</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZDLE8M8RG"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-XZDLE8M8RG',{anonymize_ip:!1})}</script><meta property="og:title" content="Azure ARM Templates - Part 4: Azure Portal Custom Deployment"><meta property="og:description" content="In my previous posts I walked through the process to author ARM templates using VS Code and the Azure Resource Manager (ARM) Tools extension. In this post I will walk through the process to author ARM templates from scratch using the Azure portal&rsquo;s Custom Deployment feature. It&rsquo;s handy for getting started with ARM template authoring, but as you will see below, creates resources with old API versions, bloats the variables element, and creates the variables element at the bottom of the template."><meta property="og:type" content="article"><meta property="og:url" content="https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/"><meta property="og:image" content="https://markkerry.github.io/images/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-01T12:03:23+01:00"><meta property="article:modified_time" content="2021-08-01T12:03:23+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://markkerry.github.io/images/cover.png"><meta name=twitter:title content="Azure ARM Templates - Part 4: Azure Portal Custom Deployment"><meta name=twitter:description content="In my previous posts I walked through the process to author ARM templates using VS Code and the Azure Resource Manager (ARM) Tools extension. In this post I will walk through the process to author ARM templates from scratch using the Azure portal&rsquo;s Custom Deployment feature. It&rsquo;s handy for getting started with ARM template authoring, but as you will see below, creates resources with old API versions, bloats the variables element, and creates the variables element at the bottom of the template."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://markkerry.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Azure ARM Templates - Part 4: Azure Portal Custom Deployment","item":"https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Azure ARM Templates - Part 4: Azure Portal Custom Deployment","name":"Azure ARM Templates - Part 4: Azure Portal Custom Deployment","description":"In my previous posts I walked through the process to author ARM templates using VS Code and the Azure Resource Manager (ARM) Tools extension. In this post I will walk through the process to author ARM templates from scratch using the Azure portal\u0026rsquo;s Custom Deployment feature. It\u0026rsquo;s handy for getting started with ARM template authoring, but as you will see below, creates resources with old API versions, bloats the variables element, and creates the variables element at the bottom of the template.","keywords":["Azure","ARM Templates","IaC"],"articleBody":"In my previous posts I walked through the process to author ARM templates using VS Code and the Azure Resource Manager (ARM) Tools extension. In this post I will walk through the process to author ARM templates from scratch using the Azure portal’s Custom Deployment feature. It’s handy for getting started with ARM template authoring, but as you will see below, creates resources with old API versions, bloats the variables element, and creates the variables element at the bottom of the template. This isn’t exactly a problem, but my preference is to have them towards top of the JSON file above the resources element.\nIn this ARM template I am are simply going to deploy:\n1 x Windows Server 2019 Datacenter Virtual Machine 1 x Network Interface 1 x Virtual Network 2 x Subnets 1 x Storage Account Create the Template Start by logging into the Azure portal and typing “deploy” into the search bar. Select Deploy a custom template.\nClick Build your own template in the editor.\nOnce you are in the editor, click Add resource.\nIn the Select a resource drop-down list, select Virtual network.\nGive it a name. In the example below I simply named it vnet1. Click OK.\nBelow you will see the json configuration for the VNet configured for you. Notice the apiVersion of 2015-06-15. I’m unsure why Azure uses this old version.\nAnd scrolling down to the variables part of the template, you can see the values Azure has created by default for the VNet address space and two subnets.\nNext, scroll back up to the top of the template and click Add resource. In the Select a resource drop-down list, select Storage Account and give it a name. I named mine stg. Click OK.\nNow we have a parameters element containing the storage account type.\nFurther down you can see the Storage Account resource.\nAnd another variable has been added for the Storage Account name. Notice the name I gave of stg has been concatinated (joined) with a unique string.\nScroll back up to the top of the template and click Add resource. In the Select a resource drop-down list, select Windows Virtual Machine. I named it vm1 and selected and existing Storage Account (stg) and Virtual network (vnet1). Click OK.\nMore parameters have been created for the VM Name, the admin username, admin password, and the OS version. The OS version has a defaultValue of 2019-Datacenter. This is in case the vm1WindowsOSVersion parameter is not specified at time of deployment.\nNow looking at the resources section we can see a Network Interface (NIC) has been defined to be added with a subnet specified. The NIC has a dependency on vnet1 being created first.\nThe next resource is the Virtual Machine. This also has two dependencies. The Storage account and the NIC.\nSo looking at the resource’s dependencies, the Storage Account and VNet will probably be created first in parallel, then the NIC will be created once the VNet completes, and finally the VM will be after the Storage Account and NIC are fully provisioned.\nAnd now the variables section contains a load more for the VM.\nNow that the final resource has been created, you can scroll to the top and select Download to save a copy and inspect the JSON file.\nDeploy the Resources And once you are ready to deploy, at the bottom of the custom template, click Save. From the drop-down menus, select the Subscription and Resource group to deploy these resources.\nThe region will be the location of the resource group you just selected, as specified in the template. The Storage Account is Standard_LRS as specified as the default in the parameters element. And the rest of the VM parameters are populated. Click Review + create.\nOnce the resources have finished deploying click Go to resource group.\nThen you will be presented with the four resources\nClean-up the Resources To clean-up the resources after you are done with them and to avoid any unnecessary spend, delete the Resource Group.\nSummary As I mentioned at the beginning of the post, authoring ARM templates using the Azure portal’s Custom deployment feature is handy for getting started with ARM template authoring, but I don’t think provides the best practices for development. This would surely fail any arm-ttk tests and also lacks the ability to automatically create any advanced features such as functions and loops etc.\nThe full JSON file for the resources created above can be found on GitHub\n","wordCount":"748","inLanguage":"en","image":"https://markkerry.github.io/images/cover.png","datePublished":"2021-08-01T12:03:23+01:00","dateModified":"2021-08-01T12:03:23+01:00","author":{"@type":"Person","name":"Mark kerry"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/"},"publisher":{"@type":"Organization","name":"markkerry.github.io","logo":{"@type":"ImageObject","url":"https://markkerry.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://markkerry.github.io/ accesskey=h title="markkerry.github.io (Alt + H)">markkerry.github.io</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://markkerry.github.io/about/ title=About><span>About</span></a></li><li><a href=https://markkerry.github.io/archive title=Archive><span>Archive</span></a></li><li><a href=https://markkerry.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://markkerry.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://markkerry.github.io/posts/>Posts</a></div><h1 class=post-title>Azure ARM Templates - Part 4: Azure Portal Custom Deployment</h1><div class=post-meta>August 1, 2021&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Mark kerry</div></header><figure class=entry-cover><img loading=lazy srcset="https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/images/cover_hu9f49b236db2d55029736233e7207b244_39367_360x0_resize_box_3.png 360w ,https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/images/cover_hu9f49b236db2d55029736233e7207b244_39367_480x0_resize_box_3.png 480w ,https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/images/cover_hu9f49b236db2d55029736233e7207b244_39367_720x0_resize_box_3.png 720w ,https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/images/cover.png 742w" sizes="(min-width: 768px) 720px, 100vw" src=https://markkerry.github.io/posts/2021/08/azure-arm-templates-part-4-custom-deployment/images/cover.png alt width=742 height=297><p>Create and deploy Azure ARM Templates in the Azure portal</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#create-the-template aria-label="Create the Template">Create the Template</a></li><li><a href=#deploy-the-resources aria-label="Deploy the Resources">Deploy the Resources</a></li><li><a href=#clean-up-the-resources aria-label="Clean-up the Resources">Clean-up the Resources</a></li><li><a href=#summary aria-label=Summary>Summary</a></li></ul></div></details></div><div class=post-content><p>In my <a href=https://markkerry.github.io/posts/2021/06/azure-arm-templates-part-1-development/>previous posts</a> I walked through the process to author ARM templates using VS Code and the <a href="https://marketplace.visualstudio.com/items?itemName=msazurermtools.azurerm-vscode-tools">Azure Resource Manager (ARM) Tools</a> extension. In this post I will walk through the process to author ARM templates from scratch using the Azure portal&rsquo;s Custom Deployment feature. It&rsquo;s handy for getting started with ARM template authoring, but as you will see below, creates resources with old API versions, bloats the variables element, and creates the variables element at the bottom of the template. This isn&rsquo;t exactly a problem, but my preference is to have them towards top of the JSON file above the resources element.</p><p>In this ARM template I am are simply going to deploy:</p><ul><li>1 x Windows Server 2019 Datacenter Virtual Machine</li><li>1 x Network Interface</li><li>1 x Virtual Network</li><li>2 x Subnets</li><li>1 x Storage Account</li></ul><h2 id=create-the-template>Create the Template<a hidden class=anchor aria-hidden=true href=#create-the-template>#</a></h2><p>Start by logging into the Azure portal and typing &ldquo;deploy&rdquo; into the search bar. Select <strong>Deploy a custom template</strong>.</p><p><img loading=lazy src=images/deployCustomTemplate.png alt=deployCustomTemplate></p><p>Click <strong>Build your own template in the editor</strong>.</p><p><img loading=lazy src=images/deployCustomTemplate2.png alt=deployCustomTemplate2></p><p>Once you are in the editor, click <strong>Add resource</strong>.</p><p><img loading=lazy src=images/addResource.png alt=addResource></p><p>In the <em>Select a resource</em> drop-down list, select <strong>Virtual network</strong>.</p><p><img loading=lazy src=images/vnet.png alt=vnet></p><p>Give it a name. In the example below I simply named it <strong>vnet1</strong>. Click <strong>OK</strong>.</p><p><img loading=lazy src=images/vnet1.png alt=vnet1></p><p>Below you will see the json configuration for the VNet configured for you. Notice the apiVersion of 2015-06-15. I&rsquo;m unsure why Azure uses this old version.</p><p><img loading=lazy src=images/vnet2.png alt=vnet2></p><p>And scrolling down to the variables part of the template, you can see the values Azure has created by default for the VNet address space and two subnets.</p><p><img loading=lazy src=images/vnet3.png alt=vnet3></p><p>Next, scroll back up to the top of the template and click <strong>Add resource</strong>. In the <em>Select a resource</em> drop-down list, select <strong>Storage Account</strong> and give it a name. I named mine <strong>stg</strong>. Click <strong>OK</strong>.</p><p><img loading=lazy src=images/stg.png alt=stg></p><p>Now we have a parameters element containing the storage account type.</p><p><img loading=lazy src=images/stg1.png alt=stg1></p><p>Further down you can see the Storage Account resource.</p><p><img loading=lazy src=images/stg2.png alt=stg2></p><p>And another variable has been added for the Storage Account name. Notice the name I gave of <strong>stg</strong> has been concatinated (joined) with a unique string.</p><p><img loading=lazy src=images/stg3.png alt=stg3></p><p>Scroll back up to the top of the template and click <strong>Add resource</strong>. In the <em>Select a resource</em> drop-down list, select <strong>Windows Virtual Machine</strong>. I named it <strong>vm1</strong> and selected and existing Storage Account (stg) and Virtual network (vnet1). Click <strong>OK</strong>.</p><p><img loading=lazy src=images/vm.png alt=vm></p><p>More parameters have been created for the VM Name, the admin username, admin password, and the OS version. The OS version has a <em>defaultValue</em> of 2019-Datacenter. This is in case the <em>vm1WindowsOSVersion</em> parameter is not specified at time of deployment.</p><p><img loading=lazy src=images/vm1params.png alt=vm1></p><p>Now looking at the resources section we can see a Network Interface (NIC) has been defined to be added with a subnet specified. The NIC has a dependency on <strong>vnet1</strong> being created first.</p><p><img loading=lazy src=images/vm2nic.png alt=vm2></p><p>The next resource is the Virtual Machine. This also has two dependencies. The Storage account and the NIC.</p><p>So looking at the resource&rsquo;s dependencies, the Storage Account and VNet will probably be created first in parallel, then the NIC will be created once the VNet completes, and finally the VM will be after the Storage Account and NIC are fully provisioned.</p><p><img loading=lazy src=images/vm3.png alt=vm3></p><p>And now the variables section contains a load more for the VM.</p><p><img loading=lazy src=images/vm4vars.png alt=vm4></p><p>Now that the final resource has been created, you can scroll to the top and select <strong>Download</strong> to save a copy and inspect the JSON file.</p><p><img loading=lazy src=images/download.png alt=download></p><h2 id=deploy-the-resources>Deploy the Resources<a hidden class=anchor aria-hidden=true href=#deploy-the-resources>#</a></h2><p>And once you are ready to deploy, at the bottom of the custom template, click <strong>Save</strong>. From the drop-down menus, select the <strong>Subscription</strong> and <strong>Resource group</strong> to deploy these resources.</p><p><img loading=lazy src=images/deploy1.png alt=deploy1></p><p>The region will be the location of the resource group you just selected, as specified in the template. The Storage Account is Standard_LRS as specified as the default in the parameters element. And the rest of the VM parameters are populated. Click <strong>Review + create</strong>.</p><p><img loading=lazy src=images/deploy2.png alt=deploy2></p><p>Once the resources have finished deploying click <strong>Go to resource group</strong>.</p><p><img loading=lazy src=images/deploy3.png alt=deploy3></p><p>Then you will be presented with the four resources</p><p><img loading=lazy src=images/deploy4.png alt=deploy4></p><h2 id=clean-up-the-resources>Clean-up the Resources<a hidden class=anchor aria-hidden=true href=#clean-up-the-resources>#</a></h2><p>To clean-up the resources after you are done with them and to avoid any unnecessary spend, delete the Resource Group.</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>As I mentioned at the beginning of the post, authoring ARM templates using the Azure portal&rsquo;s Custom deployment feature is handy for getting started with ARM template authoring, but I don&rsquo;t think provides the best practices for development. This would surely fail any <a href=https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-2-testing/#azure-resource-manager-template-toolkit>arm-ttk</a> tests and also lacks the ability to automatically create any advanced features such as functions and loops etc.</p><p>The full JSON file for the resources created above can be found <a href=https://github.com/markkerry/arm-templates/blob/main/AzureTemplateEditor.json>on GitHub</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://markkerry.github.io/tags/azure/>Azure</a></li><li><a href=https://markkerry.github.io/tags/arm-templates/>ARM Templates</a></li><li><a href=https://markkerry.github.io/tags/iac/>IaC</a></li></ul><nav class=paginav><a class=prev href=https://markkerry.github.io/posts/2021/08/create-an-azure-container-image/><span class=title>« Prev Page</span><br><span>Create and Deploy an Azure Container Instance with Azure Bicep</span></a>
<a class=next href=https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-3-deployment/><span class=title>Next Page »</span><br><span>Azure ARM Templates - Part 3: Deployment</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://markkerry.github.io/>markkerry.github.io</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>