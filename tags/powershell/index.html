<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PowerShell | markkerry.github.io</title><meta name=keywords content><meta name=description content="My personal site - https://github.com/markkerry/markkerry-hugo"><meta name=author content="Mark kerry"><link rel=canonical href=https://markkerry.github.io/tags/powershell/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><link rel=icon href=https://markkerry.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://markkerry.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://markkerry.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://markkerry.github.io/apple-touch-icon.png><link rel=mask-icon href=https://markkerry.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://markkerry.github.io/tags/powershell/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZDLE8M8RG"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XZDLE8M8RG",{anonymize_ip:!1})}</script><meta property="og:title" content="PowerShell"><meta property="og:description" content="My personal site - https://github.com/markkerry/markkerry-hugo"><meta property="og:type" content="website"><meta property="og:url" content="https://markkerry.github.io/tags/powershell/"><meta name=twitter:card content="summary"><meta name=twitter:title content="PowerShell"><meta name=twitter:description content="My personal site - https://github.com/markkerry/markkerry-hugo"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://markkerry.github.io/ accesskey=h title="markkerry.github.io (Alt + H)">markkerry.github.io</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://markkerry.github.io/about/ title=About><span>About</span></a></li><li><a href=https://markkerry.github.io/archive title=Archive><span>Archive</span></a></li><li><a href=https://markkerry.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://markkerry.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://markkerry.github.io/tags/>Tags</a></div><h1>PowerShell</h1></header><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://markkerry.github.io/posts/2023/04/deploy-automation-runbook-with-powershell/media/cover_hu44ce211cad9d7a165a3dc0c5f1660e04_24208_360x0_resize_box_3.png 360w ,https://markkerry.github.io/posts/2023/04/deploy-automation-runbook-with-powershell/media/cover_hu44ce211cad9d7a165a3dc0c5f1660e04_24208_480x0_resize_box_3.png 480w ,https://markkerry.github.io/posts/2023/04/deploy-automation-runbook-with-powershell/media/cover.png 663w" sizes="(min-width: 768px) 720px, 100vw" src=https://markkerry.github.io/posts/2023/04/deploy-automation-runbook-with-powershell/media/cover.png alt width=663 height=332></figure><header class=entry-header><h2>Deploy an Azure Automation Runbook With PowerShell</h2></header><div class=entry-content><p>The following will walk through the steps to deploy a PowerShell 5.1 and 7.1 runtime, Azure Automation Runbook, using PowerShell. This may be necessary if you are using a deployment script in a pipeline. There are two different methods to this depending on if you are deploying a runtime type of PowerShell 5.1 or PowerShell 7.1. If you want to use the ForEach-Object -Parrallel feature for example, then you will have to use PowerShell 7....</p></div><footer class=entry-footer><span title='2023-04-02 12:39:38 +0000 UTC'>April 2, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Mark kerry</footer><a class=entry-link aria-label="post link to Deploy an Azure Automation Runbook With PowerShell" href=https://markkerry.github.io/posts/2023/04/deploy-automation-runbook-with-powershell/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://markkerry.github.io/posts/2021/10/automated-autopilot-tenant-move-part2/images/cover_hudac7e09efd05c6b318817586da29454c_16669_360x0_resize_box_3.png 360w ,https://markkerry.github.io/posts/2021/10/automated-autopilot-tenant-move-part2/images/cover_hudac7e09efd05c6b318817586da29454c_16669_480x0_resize_box_3.png 480w ,https://markkerry.github.io/posts/2021/10/automated-autopilot-tenant-move-part2/images/cover.png 620w" sizes="(min-width: 768px) 720px, 100vw" src=https://markkerry.github.io/posts/2021/10/automated-autopilot-tenant-move-part2/images/cover.png alt width=620 height=197></figure><header class=entry-header><h2>Automated Autopilot Tenant Move Part 2: Using PowerShell and Graph</h2></header><div class=entry-content><p>Following on from my previous post, this one provides a far simpler process to automatically de-register your Windows Autopilot devices from one tenant, and provision them in another tenant. It’s not exactly a “part 2”, rather a different, simpler approach.
I came across a great post on MsEndpointMgr which details the steps to extract your Autopilot profile in the new tenant, and copy to the machines in the old tenant ready for them to be wiped....</p></div><footer class=entry-footer><span title='2021-10-31 09:19:49 +0100 +0100'>October 31, 2021</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Mark kerry</footer><a class=entry-link aria-label="post link to Automated Autopilot Tenant Move Part 2: Using PowerShell and Graph" href=https://markkerry.github.io/posts/2021/10/automated-autopilot-tenant-move-part2/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://markkerry.github.io/posts/2021/09/automated-autopilot-tenant-move-part1/images/cover_hu8b85997703f7fd1e8bd9dab3c1ae2e27_25957_360x0_resize_box_3.png 360w ,https://markkerry.github.io/posts/2021/09/automated-autopilot-tenant-move-part1/images/cover_hu8b85997703f7fd1e8bd9dab3c1ae2e27_25957_480x0_resize_box_3.png 480w ,https://markkerry.github.io/posts/2021/09/automated-autopilot-tenant-move-part1/images/cover.png 712w" sizes="(min-width: 768px) 720px, 100vw" src=https://markkerry.github.io/posts/2021/09/automated-autopilot-tenant-move-part1/images/cover.png alt width=712 height=146></figure><header class=entry-header><h2>Automated Autopilot Tenant Move Part 1: Using Graph, Azure Functions and Azure Storage</h2></header><div class=entry-content><p>Thanks to Powers-Hell (Ben) for the handy Get-AuthHeader and Invoke-GraphCall PowerShell functions.
Introduction There may be a scenario where you need all of your Intune managed, Autopilot registered devices setup on a new tenant. But there are a few challenges you will face:
An OEM may have uploaded every device’s hardware hash to Autopilot, so you do not have them to upload to the new tenant. An Autopilot device cannot be deleted from the registration service while it’s a “managed device” (enrolled in Intune)....</p></div><footer class=entry-footer><span title='2021-09-26 10:31:24 +0100 +0100'>September 26, 2021</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Mark kerry</footer><a class=entry-link aria-label="post link to Automated Autopilot Tenant Move Part 1: Using Graph, Azure Functions and Azure Storage" href=https://markkerry.github.io/posts/2021/09/automated-autopilot-tenant-move-part1/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-3-deployment/images/cover_hua0a4c3bbf7eb11702eff01adcd365f7c_18751_360x0_resize_box_3.png 360w ,https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-3-deployment/images/cover_hua0a4c3bbf7eb11702eff01adcd365f7c_18751_480x0_resize_box_3.png 480w ,https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-3-deployment/images/cover.png 520w" sizes="(min-width: 768px) 720px, 100vw" src=https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-3-deployment/images/cover.png alt width=520 height=271></figure><header class=entry-header><h2>Azure ARM Templates - Part 3: Deployment</h2></header><div class=entry-content><p>In the third and final post of this series I’ll quickly cover the process to deploy the ARM template with PowerShell
Deploy Open PowerShell and change directory to the location of your ARM template and parameter files. Then complete the following commands to connect to Azure and create a Resource Group to deploy the resources to:
# Import the Azure Az PowerShell Module Import-Module -Name Az # Connect to Azure and authenticate Connect-AzAccount # Create the Resource Group New-AzResourceGroup -Name "rg-eu-vm" -Location "westeurope" Once the Resource Group has been created it’s time to deploy the resources using the New-AzResourceGroupDeployment cmdlet....</p></div><footer class=entry-footer><span title='2021-07-04 12:55:22 +0100 +0100'>July 4, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Mark kerry</footer><a class=entry-link aria-label="post link to Azure ARM Templates - Part 3: Deployment" href=https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-3-deployment/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-2-testing/images/cover_hu982d4e825f3c4787d83bcb8388542dbc_22917_360x0_resize_box_3.png 360w ,https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-2-testing/images/cover_hu982d4e825f3c4787d83bcb8388542dbc_22917_480x0_resize_box_3.png 480w ,https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-2-testing/images/cover.png 662w" sizes="(min-width: 768px) 720px, 100vw" src=https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-2-testing/images/cover.png alt width=662 height=346></figure><header class=entry-header><h2>Azure ARM Templates - Part 2: Testing</h2></header><div class=entry-content><p>Following on from authoring the Azure ARM Templates - Part 1: Development post, in this one I will cover testing the ARM template.
Two potential ways to test the ARM templates is by manually building a Pester test, and another is by using Microsoft’s Azure Resource Manager Template Toolkit (arm-ttk) module.
You can run local tests against ARM templates using PowerShell - which I will demonstrate in the post - but most commonly template testing and validating is used during a CI pipeline....</p></div><footer class=entry-footer><span title='2021-07-03 15:50:08 +0100 +0100'>July 3, 2021</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Mark kerry</footer><a class=entry-link aria-label="post link to Azure ARM Templates - Part 2: Testing" href=https://markkerry.github.io/posts/2021/07/azure-arm-templates-part-2-testing/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://markkerry.github.io/posts/2021/05/msipatches-powershell-module/images/cover_hua9b48e89c7bab492b4a796924088d28e_25226_360x0_resize_box_3.png 360w ,https://markkerry.github.io/posts/2021/05/msipatches-powershell-module/images/cover_hua9b48e89c7bab492b4a796924088d28e_25226_480x0_resize_box_3.png 480w ,https://markkerry.github.io/posts/2021/05/msipatches-powershell-module/images/cover.png 657w" sizes="(min-width: 768px) 720px, 100vw" src=https://markkerry.github.io/posts/2021/05/msipatches-powershell-module/images/cover.png alt width=657 height=286></figure><header class=entry-header><h2>MSIPatches PowerShell Module</h2></header><div class=entry-content><p>I created a PowerShell module a few years back to safely purge the C:\Windows\Installer directory of any orphaned MSI patches. This directory can often grow very large in size due to applications such as Microsoft Office (MSI not Click-to-Run) being regularly patched. Superseded patches get left behind leaving them in an orphaned state. The MSIPatches module can detect and move the orphaned patches freeing up valuable disk space.
This module requires the MSI module by Heath Stewart, which will be automatically installed when MSIPatches module is installed....</p></div><footer class=entry-footer><span title='2021-05-28 12:51:14 +0100 +0100'>May 28, 2021</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Mark kerry</footer><a class=entry-link aria-label="post link to MSIPatches PowerShell Module" href=https://markkerry.github.io/posts/2021/05/msipatches-powershell-module/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://markkerry.github.io/posts/2021/04/serverless-laps-azure-function/images/cover_hu121f4f4a3965575e5f6eedf353b8a073_27651_360x0_resize_box_3.png 360w ,https://markkerry.github.io/posts/2021/04/serverless-laps-azure-function/images/cover_hu121f4f4a3965575e5f6eedf353b8a073_27651_480x0_resize_box_3.png 480w ,https://markkerry.github.io/posts/2021/04/serverless-laps-azure-function/images/cover.png 667w" sizes="(min-width: 768px) 720px, 100vw" src=https://markkerry.github.io/posts/2021/04/serverless-laps-azure-function/images/cover.png alt width=667 height=206></figure><header class=entry-header><h2>Serverless LAPS Azure Function and Proactive Remediation</h2></header><div class=entry-content><p>Based on the great solution created by John Seerden with a little help creating and deploying Azure Functions by the Serverless on Azure YouTube channel.
All of the code in this post can be found in my GitHub repo
I am only posting a few differences here, such as creating the Azure resources using AZ CLI and creating/testing/deploying the function using the Azure Functions Core Tools CLI.
What is Serverless LAPS Local Admin Password Solution (LAPS) is a great solution from Microsoft to allow IT admins to automatically recycle local admin accounts on domain joined Windows machines....</p></div><footer class=entry-footer><span title='2021-04-25 11:04:45 +0100 +0100'>April 25, 2021</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Mark kerry</footer><a class=entry-link aria-label="post link to Serverless LAPS Azure Function and Proactive Remediation" href=https://markkerry.github.io/posts/2021/04/serverless-laps-azure-function/></a></article></main><footer class=footer><span>&copy; 2023 <a href=https://markkerry.github.io/>markkerry.github.io</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>